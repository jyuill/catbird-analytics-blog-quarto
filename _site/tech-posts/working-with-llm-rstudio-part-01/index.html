<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.547">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="John Yuill">
<meta name="dcterms.date" content="2024-08-25">
<meta name="description" content="Exploring options for integrating LLMs into RStudio workflows.">

<title>Catbird Analytics - Working with LLM AI inside RStudio, part 1</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/cookie-consent/cookie-consent.js"></script>
<link href="../../site_libs/cookie-consent/cookie-consent.css" rel="stylesheet">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-5XF0SHH0KW"></script>

<script type="text/plain" cookie-consent="tracking">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-5XF0SHH0KW', { 'anonymize_ip': true});
</script>

<script type="text/javascript" charset="UTF-8">
document.addEventListener('DOMContentLoaded', function () {
cookieconsent.run({
  "notice_banner_type":"simple",
  "consent_type":"implied",
  "palette":"light",
  "language":"en",
  "page_load_consent_levels":["strictly-necessary","functionality","tracking","targeting"],
  "notice_banner_reject_button_hide":false,
  "preferences_center_close_button_hide":false,
  "website_name":""
  ,
"language":"en"
  });
});
</script> 
  


<link rel="stylesheet" href="../../styles.css">
<meta property="og:title" content="Catbird Analytics - Working with LLM AI inside RStudio, part 1">
<meta property="og:description" content="">
<meta property="og:image" content="dalle2-2024-08-26-llm-data-analysis_sm2.png">
<meta property="og:site_name" content="Catbird Analytics">
</head>

<body class="floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Catbird Analytics</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-data-products" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Data Products</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-data-products">    
        <li>
    <a class="dropdown-item" href="../../products/bc-lmr-dashboard.html">
 <span class="dropdown-text">BC Liquor Market Dashboard</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../products/savings-burndown-sim.html">
 <span class="dropdown-text">Savings Burndown Simulator</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../portfolio.html">
 <span class="dropdown-text">More to Come</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../../portfolio.html"> 
<span class="menu-text">Portfolio</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../tech-blog.html"> 
<span class="menu-text">Tech Blog</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/johnyuill/"> <i class="bi bi-linkedin" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/jyuill"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/johnyuill"> <i class="bi bi-twitter" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#large-language-model-ai-tools-in-r-studio" id="toc-large-language-model-ai-tools-in-r-studio" class="nav-link active" data-scroll-target="#large-language-model-ai-tools-in-r-studio">Large Language Model AI Tools in R Studio</a>
  <ul class="collapse">
  <li><a href="#first-some-data" id="toc-first-some-data" class="nav-link" data-scroll-target="#first-some-data">First, some data</a></li>
  <li><a href="#github-copilot" id="toc-github-copilot" class="nav-link" data-scroll-target="#github-copilot">Github Copilot</a></li>
  <li><a href="#chattr" id="toc-chattr" class="nav-link" data-scroll-target="#chattr">chattr</a></li>
  <li><a href="#gptstudio" id="toc-gptstudio" class="nav-link" data-scroll-target="#gptstudio">gptstudio</a></li>
  </ul></li>
  </ul>
</nav>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Working with LLM AI inside RStudio, part 1</h1>
  <div class="quarto-categories">
    <div class="quarto-category">analysis</div>
  </div>
  </div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>John Yuill </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">August 25, 2024</p>
    </div>
  </div>
  
    <div>
    <div class="quarto-title-meta-heading">Modified</div>
    <div class="quarto-title-meta-contents">
      <p class="date-modified">April 6, 2025</p>
    </div>
  </div>
    
  </div>
  


</header>


<section id="large-language-model-ai-tools-in-r-studio" class="level2">
<h2 class="anchored" data-anchor-id="large-language-model-ai-tools-in-r-studio">Large Language Model AI Tools in R Studio</h2>
<p>Part 1 of exploring integration of LLM tools into R Studio for more efficient data analysis and faster speed to insights.</p>
<p>Looking at some of the more well-known options, with relatively simple examples that give an idea of some, but by no means all, of the capabilities.</p>
<ol type="1">
<li>GitHub Copilot</li>
<li>chattr package</li>
<li>gptstudio package</li>
</ol>
<section id="first-some-data" class="level3">
<h3 class="anchored" data-anchor-id="first-some-data">First, some data</h3>
<p>Here’s the data set we’ll use throughout these examples:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="fu">here</span>(<span class="st">'data'</span>,<span class="st">'lmr-data.csv'</span>), <span class="at">show_col_types =</span> <span class="cn">FALSE</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(data, <span class="at">width=</span><span class="dv">80</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 5,699
Columns: 14
$ lmr_id       &lt;dbl&gt; 17, 22, 27, 32, 37, 42, 47, 52, 57, 62, 67, 72, 77, 82, 8…
$ fy_qtr       &lt;chr&gt; "FY2016Q1", "FY2016Q1", "FY2016Q1", "FY2016Q1", "FY2016Q1…
$ cat_type     &lt;chr&gt; "Beer", "Beer", "Beer", "Beer", "Beer", "Beer", "Beer", "…
$ category     &lt;chr&gt; "Domestic - BC Beer", "Domestic - BC Beer", "Domestic - B…
$ subcategory  &lt;chr&gt; "Domestic - BC Commercial Beer", "Domestic - BC Micro Bre…
$ netsales     &lt;dbl&gt; 173628845, 16988008, 32389411, 15818440, 169352, 2801993,…
$ litres       &lt;dbl&gt; 52236010, 3927908, 9094263, 4378195, 25073, 862782, 38289…
$ fyr          &lt;dbl&gt; 2016, 2016, 2016, 2016, 2016, 2016, 2016, 2016, 2016, 201…
$ qtr          &lt;chr&gt; "Q1", "Q1", "Q1", "Q1", "Q1", "Q1", "Q1", "Q1", "Q1", "Q1…
$ end_qtr      &lt;chr&gt; "06-30", "06-30", "06-30", "06-30", "06-30", "06-30", "06…
$ end_qtr_dt   &lt;date&gt; 2015-06-30, 2015-06-30, 2015-06-30, 2015-06-30, 2015-06-…
$ cyr          &lt;dbl&gt; 2015, 2015, 2015, 2015, 2015, 2015, 2015, 2015, 2015, 201…
$ season       &lt;chr&gt; "summer", "summer", "summer", "summer", "summer", "summer…
$ start_qtr_dt &lt;date&gt; 2015-06-01, 2015-06-01, 2015-06-01, 2015-06-01, 2015-06-…</code></pre>
</div>
</div>
</section>
<section id="github-copilot" class="level3">
<h3 class="anchored" data-anchor-id="github-copilot">Github Copilot</h3>
<p>Copilot is pretty much a must-have to help with your coding, imo. That is, of course, as long as you’re willing to pay for it, since it <strong>requires a Copilot subscription</strong>.</p>
<p>Posit has a <a href="https://docs.posit.co/ide/user/ide/guide/tools/copilot.html">GitHub Copilot guide</a> that gives you pretty much everything you need to get going.</p>
<ul>
<li>easy integratiion with RStudio via <strong>Tools &gt; Global Options</strong>.</li>
<li>real-time code suggestions -&gt; way beyond traditional autocomplete offers.</li>
<li>suggestions can even provide good practices for coding efficiency or other techniques that you may not be aware of.</li>
<li>doesn’t work well in ‘Visual’ mode, so you’ll need to switch to ‘Source’ mode to get the most out of it.</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="github-copilot-r-settings.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="400"></p>
</figure>
</div>
<p>Most folks are probably pretty familiar with how Copilot works, and there are lots of great resources, so I’ll just throw in a simple R-specific example here.</p>
<section id="promptresponse-1" class="level4">
<h4 class="anchored" data-anchor-id="promptresponse-1">Prompt/response #1:</h4>
<ul>
<li>After loading the data, the comment specifies what we want to do next.</li>
<li>I started typing ‘data_’ and the greyed-out code was supplied by Copilot.</li>
<li>To accept, I just hit ‘tab’ and execute.</li>
</ul>
<p><img src="copilot_01.png" class="img-fluid"></p>
<p>Resulting in a serviceable chart:</p>
<p><img src="copilot_01_chart.png" class="img-fluid" width="300"></p>
</section>
<section id="promptresponse-2" class="level4">
<h4 class="anchored" data-anchor-id="promptresponse-2">Prompt/response #2:</h4>
<ul>
<li>Going for some refinement: this time, I type in more detailed intentions, and Copilot provides all the greyed-out code, without me typing any code at all:</li>
</ul>
<p><img src="copilot_02.png" class="img-fluid"></p>
<p>Result looks good - although ‘removal of x-axis ticks’ got missed:</p>
<p><img src="copilot_02_chart.png" class="img-fluid" width="300"></p>
</section>
<section id="promptresponse-3" class="level4">
<h4 class="anchored" data-anchor-id="promptresponse-3">Prompt/response #3:</h4>
<ul>
<li>One more set of minor refinements, these get incorporated in for a complete set of code to deliver the intended result</li>
</ul>
<p><img src="copilot_03.png" class="img-fluid"></p>
<p>Result:</p>
<p><img src="copilot_03_chart.png" class="img-fluid" width="300"></p>
<p>A basic example, but shows the power of having this assistant at hand. Also highlights the way <strong>these tools are particularly helpful to less-experienced programmers</strong>: an experienced pro would be able to do all this as fast as Copilot but this really helps to level-up those who know what they want to do, but don’t have all the code nuances at their fingertips.</p>
</section>
</section>
<section id="chattr" class="level3">
<h3 class="anchored" data-anchor-id="chattr">chattr</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(chattr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><a href="https://mlverse.github.io/chattr/">chattr</a> is a package that enables interacting with LLMs from within the RStudio environment. The intention is to go well beyond the code-focused content of Copilot.</p>
<p>Once you install and load the package, you can use the <code>chattr</code> function to interact with the LLM. The <code>chattr_use</code> function provides the ability to choose the model to use: <em>(options may vary over time)</em></p>
<p><img src="chattr_models.png" class="img-fluid" width="350"></p>
<p>The choice of model will effect the quality and form of output that you get. Most examples below were done with gpt-4 - you may see very different results.</p>
<p>After you’ve made a selection, you can test your connection and confirm which model you are using with <code>chattr_test</code> function:</p>
<p><img src="chattr_test.png" class="img-fluid" width="400"></p>
<p>If you don’t have a successful test, best to go to the <a href="https://mlverse.github.io/chattr/">chattr Github documentation</a> for advice.</p>
<p>There are a couple of ways to interact with chattr:</p>
<ol type="1">
<li><p>use ‘<strong>chattr(prompt = “<strong>&lt;prompt here&gt;</strong>”)</strong>’ inline, directly in a code block to generate code.</p></li>
<li><p>use <strong>Addins &gt; CHATTR &gt; Open Chat</strong> to open an app in the Viewer window, where you can interact through an interface.</p></li>
</ol>
<section id="inline-chattr" class="level4">
<h4 class="anchored" data-anchor-id="inline-chattr">Inline chattr</h4>
<p>Works best if you want to interact from a Quarto or RMarkdown doc, since you add prompts to your code chunks and get the code built out there for use.</p>
<ol type="1">
<li>enter <strong>chattr(prompt = “&lt;prompt here&gt;”)</strong> in your code block - works from Visual mode in Quarto (unlike Copilot).</li>
<li>move the cursor to somewhere BELOW the prompt text.</li>
<li>Without having access to your actual dataset, I can’t provide the exact code. However, I can provide a general approach using the tidyverse andrun the code block to generate the code to answer your question.</li>
<li>to get the actual results, comment out the original chattr prompt (only need one ‘#’ before ‘chattr’) and run the new code provided.</li>
<li>fix as necessary</li>
</ol>
<section id="prompt-1" class="level5">
<h5 class="anchored" data-anchor-id="prompt-1">Prompt #1:</h5>
<p>A basic question along the lines of what we were doing with Copilot (maybe slightly more advanced). Produces basic chart that answers the question. (prompt in commented out in order to show the results from the R code that was provided)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">#chattr(prompt = "for the data dataframe I have in my session, how can i show the trend in netsales for cat_type 'Beer' by cyr from 2016 to 2022?")</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the required libraries</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter the data for cat_type 'Beer' and years 2016 to 2022</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>data_beer <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> </span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(cat_type <span class="sc">==</span> <span class="st">'Beer'</span> <span class="sc">&amp;</span> cyr <span class="sc">&gt;=</span> <span class="dv">2016</span> <span class="sc">&amp;</span> cyr <span class="sc">&lt;=</span> <span class="dv">2022</span>)</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Summarize the data to get total net sales by cyr</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>data_summarized <span class="ot">&lt;-</span> data_beer <span class="sc">%&gt;%</span> </span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cyr) <span class="sc">%&gt;%</span> </span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">total_netsales =</span> <span class="fu">sum</span>(netsales))</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the line chart</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data_summarized, <span class="fu">aes</span>(<span class="at">x =</span> cyr, <span class="at">y =</span> total_netsales)) <span class="sc">+</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/chattr_01-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="prompt-2" class="level5">
<h5 class="anchored" data-anchor-id="prompt-2">Prompt #2:</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">#chattr("what is the highest year of total_netsales for Beer?")</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the required libraries</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidymodels)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter the data for cat_type 'Beer'</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>data_beer <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> </span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(cat_type <span class="sc">==</span> <span class="st">'Beer'</span>)</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Summarize the data to get total net sales by cyr</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>data_summarized <span class="ot">&lt;-</span> data_beer <span class="sc">%&gt;%</span> </span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cyr) <span class="sc">%&gt;%</span> </span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">total_netsales =</span> <span class="fu">sum</span>(netsales))</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Find the year with the highest total_netsales</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>highest_year <span class="ot">&lt;-</span> data_summarized <span class="sc">%&gt;%</span> </span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(total_netsales <span class="sc">==</span> <span class="fu">max</span>(total_netsales)) <span class="sc">%&gt;%</span> </span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(cyr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note that for this one, the value in stored in a variable in your session:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(highest_year)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2018</code></pre>
</div>
</div>
</section>
<section id="prompt-3" class="level5">
<h5 class="anchored" data-anchor-id="prompt-3">Prompt #3:</h5>
<p>A little more complex example, where I have included some hints. Close but some problems…</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># commented out to keep the prompt but not re-run:</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="co">#chattr(prompt = "what was the total percentage change in total net sales for Beer over the period 2016 to 2022, and what year had the largest year-over-year percentage change, either positive or negative? my data set is called data_beer, Beer is in cat_type variable, year is in cyr variable, and sales are in netsales variable.")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="chattr_prompt_03_output2_err.png" class="img-fluid"></p>
<p>Works with minor modifications:</p>
<ul>
<li>set separate lines for loading libraries and add ‘)’</li>
<li>add ‘#’ to one of the comment lines</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the libraries</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidymodels)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter the data for the years 2016 to 2022 and for the category type 'Beer'</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>data_beer_filtered <span class="ot">&lt;-</span> data_beer <span class="sc">%&gt;%</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(cyr <span class="sc">&gt;=</span> <span class="dv">2016</span> <span class="sc">&amp;</span> cyr <span class="sc">&lt;=</span> <span class="dv">2022</span> <span class="sc">&amp;</span> cat_type <span class="sc">==</span> <span class="st">'Beer'</span>)</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the total net sales for each year</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>total_sales_per_year <span class="ot">&lt;-</span> data_beer_filtered <span class="sc">%&gt;%</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cyr) <span class="sc">%&gt;%</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">total_netsales =</span> <span class="fu">sum</span>(netsales))</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the percentage change in total net sales for each year</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>total_sales_per_year <span class="ot">&lt;-</span> total_sales_per_year <span class="sc">%&gt;%</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">percentage_change =</span> (total_netsales<span class="sc">/</span><span class="fu">lag</span>(total_netsales) <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> <span class="dv">100</span>)</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the total percentage change in total net sales over the period2016 to 2022</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>total_percentage_change <span class="ot">&lt;-</span> (total_sales_per_year<span class="sc">$</span>total_netsales[<span class="fu">nrow</span>(total_sales_per_year)] <span class="sc">/</span> total_sales_per_year<span class="sc">$</span>total_netsales[<span class="dv">1</span>] <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Find the year with the largest year-over-year percentage</span></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>year_largest_change <span class="ot">&lt;-</span> total_sales_per_year <span class="sc">%&gt;%</span></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(percentage_change <span class="sc">==</span> <span class="fu">max</span>(percentage_change, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(cyr)</span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the total percentage change and year with the largest change</span></span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>total_percentage_change</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.1579791</code></pre>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>year_largest_change</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2017</code></pre>
</div>
</div>
<p>This is pretty minor fix, and a fairly small price to pay for a LOT of free code. But does highlight that <strong>these tools aren’t perfect</strong> (surprise, surprise!).</p>
</section>
</section>
<section id="addin-not-working" class="level4">
<h4 class="anchored" data-anchor-id="addin-not-working">Addin [not working]</h4>
<p>(Addin not working last time it was tried - Apr 2025)</p>
<p><img src="addin-chattr.png" class="img-fluid" width="100"></p>
<p>The main selling point for chattr is intended to be the <strong>interactive app accessed via the Viewer window</strong>. You can access this through <strong>Addins &gt; CHATTR &gt;</strong> ‘<strong>Open Chat</strong>’ option.</p>
<p>With this approach, you can get more running conversation and can copy/paste code as needed into your R file. It is text-based only, so no matter what model you are using, you can’t upload files for analysis or have direction interaction between the data in your R session and the LLM.</p>
<p>Overall, maybe keeps things cleaner and is more flexible than accessing in-line, although:</p>
<ul>
<li>a) you have to jump back and forth to some degree (although having the Viewer window available helps),</li>
<li>b) you don’t have a built-in reference for future (if needed),</li>
<li>c) you can’t interact with your console or run any code while the app is running - it is a Shiny app, so the normal situation applies.</li>
</ul>
<section id="prompt-4-via-chat-window" class="level5">
<h5 class="anchored" data-anchor-id="prompt-4-via-chat-window">Prompt 4 (via chat window):</h5>
<p>Here’s the results using the same prompt as above. As you can see, very similar results, in this case with the prompt below and then the text + code provided.</p>
<p><img src="chattr_prompt_viewer.png" class="img-fluid" width="800"></p>
<p>One advantage over something like Copilot is that you have access to a LOT more information that you can use to answer broader questions, beyond just code, that can help with your analysis.</p>
<p>[provide screenshot from more sophisticated conversation with Viewer window]</p>
<p>code provided by prompt below - fails on calculating subcategory change: all NA</p>
<p><img src="chattr_viewer_prompt.png" class="img-fluid" width="300"></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate annual total revenue for each subcategory</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>annual_revenue <span class="ot">&lt;-</span> data_beer <span class="sc">%&gt;%</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cyr, subcategory) <span class="sc">%&gt;%</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">netsales =</span> <span class="fu">sum</span>(netsales, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate annual total revenue change for each subcategory</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>annual_revenue_change <span class="ot">&lt;-</span> annual_revenue <span class="sc">%&gt;%</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(cyr, subcategory) <span class="sc">%&gt;%</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(subcategory) <span class="sc">%&gt;%</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">revenue_change =</span> netsales <span class="sc">-</span> <span class="fu">lag</span>(netsales))</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a><span class="co"># View the data</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(annual_revenue_change)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 4
# Groups:   subcategory [6]
    cyr subcategory                                netsales revenue_change
  &lt;dbl&gt; &lt;chr&gt;                                         &lt;dbl&gt;          &lt;dbl&gt;
1  2015 Asia And South Pacific Beer                 5380425             NA
2  2015 Domestic - BC Commercial Beer             486328170             NA
3  2015 Domestic - BC Micro Brew Beer              57536956             NA
4  2015 Domestic - BC Regional Beer                98691340             NA
5  2015 Domestic - Other Province Commercial Beer  42829824             NA
6  2015 Domestic - Other Province Micro Brew Beer    563027             NA</code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="gptstudio" class="level3">
<h3 class="anchored" data-anchor-id="gptstudio">gptstudio</h3>
<p>MAY MOVE THIS TO SEPARATE ARTICLE PART II</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co">#library(gptstudio)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="addin" class="level4">
<h4 class="anchored" data-anchor-id="addin">Addin</h4>
<p><img src="gptstudio_addin.png" class="img-fluid" width="200"></p>
<ul>
<li>real-time prompting in Viewer pane with text responses</li>
<li>provides code suggestions based on prompts that you can then copy/paste into your R file</li>
<li>doesn’t have visibility into your code in your R file</li>
<li>clunky interface in Viewer pane</li>
</ul>


</section>
</section>
</section>

</main> <!-- /main -->

<div class="custom-footer" style="text-align: center; padding: 1rem 0; font-size: 0.9em;">
  <hr>
  <p>© 2025 <a href="https://catbird-analytics.com">Catbird Analytics</a> • Built with <a href="https://quarto.org">Quarto</a></p>
</div>


<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">

<div class="cookie-consent-footer"><a href="#" id="open_preferences_center">Cookie Preferences</a></div></div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>